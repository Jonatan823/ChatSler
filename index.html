<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SLER MOTOR V2 - PRIVATE IDE</title>
    <style>
        :root { --bg: #0d0d0f; --panel: #16161a; --accent: #007acc; --sler-m: #4ec9b0; --sler-c: #ce9178; --text: #d4d4d4; }
        body, html { margin: 0; padding: 0; height: 100%; background: var(--bg); color: var(--text); font-family: 'Consolas', 'Courier New', monospace; overflow: hidden; }

        /* --- ACCESO PRIVADO --- */
        #gatekeeper { position: fixed; inset: 0; background: #050505; z-index: 10000; display: flex; align-items: center; justify-content: center; flex-direction: column; }
        .gate-card { border: 1px solid var(--accent); padding: 30px; background: var(--panel); text-align: center; box-shadow: 0 0 30px rgba(0,122,204,0.2); }
        input[type="password"] { background: #000; border: 1px solid #333; color: var(--sler-m); padding: 12px; width: 250px; text-align: center; margin-bottom: 15px; outline: none; }
        
        /* --- ESTRUCTURA DASHBOARD --- */
        #app-container { display: none; height: 100vh; display: flex; }
        
        /* Sidebar */
        #sidebar { width: 260px; background: var(--panel); border-right: 1px solid #2d2d33; display: flex; flex-direction: column; padding: 15px; }
        .module-title { font-size: 10px; color: var(--accent); letter-spacing: 1px; margin-bottom: 10px; border-bottom: 1px solid #333; padding-bottom: 5px; }
        #user-list { flex: 1; overflow-y: auto; }
        .user-item { padding: 8px; font-size: 12px; cursor: pointer; border-radius: 3px; margin-bottom: 4px; border: 1px solid transparent; }
        .user-item:hover { background: #1e1e24; border-color: #444; }
        .user-item.active { background: #264f78; color: white; border-color: var(--accent); }

        /* Main Chat */
        #main-chat { flex: 1; display: flex; flex-direction: column; background: #0a0a0c; }
        #chat-stream { flex: 1; overflow-y: auto; padding: 25px; scroll-behavior: smooth; }
        .msg-block { margin-bottom: 20px; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* --- SEMÁNTICA SLER --- */
        .sler-m { color: var(--sler-m); font-weight: bold; display: block; line-height: 1.1; }
        .sler-c { color: var(--sler-c); font-style: italic; display: block; line-height: 1.1; padding-left: 10px; margin-top: 2px; }
        .msg-meta { font-size: 9px; color: #666; margin-bottom: 4px; }

        /* Input Area */
        #input-area { padding: 20px; background: var(--panel); border-top: 1px solid #2d2d33; display: flex; gap: 10px; }
        #texto { flex: 1; background: #000; border: 1px solid #333; color: white; padding: 12px; font-family: 'Consolas'; outline: none; }
        #texto:focus { border-color: var(--accent); }
        button { background: var(--accent); color: white; border: none; padding: 0 25px; cursor: pointer; font-weight: bold; }
        button:hover { filter: brightness(1.2); }
    </style>
</head>
<body>

    <div id="gatekeeper">
        <div class="gate-card">
            <div style="font-size: 12px; color: var(--accent); margin-bottom: 20px;">SLER MOTOR V2 - AUTHORIZATION</div>
            <input type="password" id="pass-input" placeholder="INGRESE CLAVE PRIVADA">
            <button onclick="login()" style="width: 100%; height: 40px;">ENTRAR</button>
        </div>
    </div>

    <div id="app-container" style="display: none;">
        <aside id="sidebar">
            <div class="module-title">OPERADORES ACTIVOS</div>
            <div id="user-list">
                <div class="user-item active" onclick="selectTarget('GLOBAL', this)">● CANAL_GLOBAL</div>
            </div>
            
            <div class="module-title" style="margin-top: 20px; color: #dcdcaa;">AUDITORÍA IA (SLER-B)</div>
            <div style="font-size: 11px; color: #666;">
                SOLICITUDES: <span id="ext-count" style="color: #dcdcaa; font-weight: bold;">0</span><br>
                PROTOCOLO: BINDING_V1
            </div>
        </aside>

        <main id="main-chat">
            <div id="chat-stream"></div>
            <div id="input-area">
                <input type="text" id="texto" placeholder="Escribir mensaje en modo SLER...">
                <button id="btn-enviar">EJECUTAR</button>
            </div>
        </main>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyD5ITa76Xc7mmihQPC2AUCHQFStii4NAUg",
            authDomain: "sler-chat-lab.firebaseapp.com",
            databaseURL: "https://sler-chat-lab-default-rtdb.firebaseio.com",
            projectId: "sler-chat-lab",
            storageBucket: "sler-chat-lab.firebasestorage.app",
            messagingSenderId: "594954603335",
            appId: "1:594954603335:web:d332aa211e8ecce5521a62"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let targetUser = "GLOBAL";
        let extRequests = 0;

        // --- SEGURIDAD ---
        function login() {
            const pass = document.getElementById('pass-input').value;
            if(pass === "joniclapton") {
                document.getElementById('gatekeeper').style.display = 'none';
                document.getElementById('app-container').style.display = 'flex';
                initMotor();
            } else {
                alert("CREDENCIAL INVÁLIDA");
            }
        }

        // --- MOTOR SEMÁNTICO SLER ---
        function procesarSler(texto) {
            return texto.split(" ").map(pal => {
                // Si la palabra tiene más de 5 letras, aplicamos guionado antagónico
                if(pal.length > 5) {
                    const mitad = Math.ceil(pal.length / 2);
                    const m = pal.substring(0, mitad);
                    const c = pal.substring(mitad);
                    return `<span class="sler-m">${m}-</span><span class="sler-c">-${c}</span>`;
                }
                return pal;
            }).join(" ");
        }

        // --- LÓGICA DE CHAT ---
        function initMotor() {
            document.getElementById('btn-enviar').onclick = enviarMensaje;
            
            // Escuchar Mensajes
            db.ref('mensajes').limitToLast(50).on('child_added', (snap) => {
                const msg = snap.val();
                renderMsg(msg);
                
                // Actualizar Auditoría
                extRequests++;
                document.getElementById('ext-count').innerText = extRequests;
                
                // Agregar a lista de nicks si no existe
                updateSidebar(msg.usuario);
            });
        }

        function enviarMensaje() {
            const input = document.getElementById('texto');
            if(input.value.trim() !== "") {
                db.ref('mensajes').push({
                    usuario: "JoniClapton",
                    target: targetUser,
                    contenido: input.value,
                    timestamp: Date.now()
                });
                input.value = "";
            }
        }

        function renderMsg(msg) {
            const stream = document.getElementById('chat-stream');
            const div = document.createElement('div');
            div.className = "msg-block";
            
            const slerContent = procesarSler(msg.contenido);
            
            div.innerHTML = `
                <div class="msg-meta">FROM: ${msg.usuario} | TO: ${msg.target || 'GLOBAL'}</div>
                <div class="sler-render">${slerContent}</div>
            `;
            stream.appendChild(div);
            stream.scrollTop = stream.scrollHeight;
        }

        function updateSidebar(nick) {
            const list = document.getElementById('user-list');
            if(!document.getElementById('nick-' + nick)) {
                const div = document.createElement('div');
                div.id = 'nick-' + nick;
                div.className = 'user-item';
                div.innerText = '● ' + nick;
                div.onclick = () => selectTarget(nick, div);
                list.appendChild(div);
            }
        }

        function selectTarget(nick, el) {
            targetUser = nick;
            document.querySelectorAll('.user-item').forEach(u => u.classList.remove('active'));
            el.classList.add('active');
        }
    </script>
</body>
</html>

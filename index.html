<div id="quick-access-sler" style="position:fixed; inset:0; background:#c0c0c0; z-index:10000; display:flex; align-items:center; justify-content:center; font-family:'Courier New';">
    <div style="background:#fff; padding:30px; border:5px solid #000; text-align:center; max-width:400px;">
        <h2 style="text-decoration:underline;">ENTRENAMIENTO SLER</h2>
        <p>Introduce un Nick para comenzar el análisis:</p>
        <input type="text" id="quick-nick" placeholder="TU NICK" style="width:100%; padding:10px; border:2px solid #000; text-align:center; margin-bottom:10px;">
        <button onclick="registroRapidoTest()" style="width:100%; padding:15px; background:#000; color:#fff; border:none; cursor:pointer; font-weight:bold;">COMENZAR TEST</button>
        <p id="status-test" style="font-size:11px; margin-top:10px;"></p>
    </div>
</div>

<script>
// Configuración de Firebase (usa la misma que en el Chat)
const firebaseConfig = { /* Tu Configuración */ };
if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const auth = firebase.auth();

function registroRapidoTest() {
    const nick = document.getElementById('quick-nick').value.trim();
    const status = document.getElementById('status-test');
    
    if(!nick) return alert("Escribe un Nick");

    status.innerText = "Sincronizando con Nodo Central...";

    // 1. Entramos como anónimo para tener UID de Firebase
    auth.signInAnonymously().then(res => {
        // 2. Registramos el Nick en la base de datos de usuarios
        db.ref('usuarios/' + nick).set({
            nick: nick,
            origen: "test_directo",
            online: true,
            uid: res.user.uid,
            fecha_registro: firebase.database.ServerValue.TIMESTAMP
        }).then(() => {
            // 3. Guardamos en el navegador para que el chat lo reconozca después
            localStorage.setItem('sler_nick', nick);
            // 4. Liberamos el test
            document.getElementById('quick-access-sler').style.display = 'none';
            console.log("Cliente capturado: " + nick);
        });
    }).catch(e => {
        status.innerText = "Error de conexión. Intenta de nuevo.";
        console.error(e);
    });
}

// Si ya tiene el Nick guardado de antes, saltamos el paso
if(localStorage.getItem('sler_nick')) {
    document.getElementById('quick-access-sler').style.display = 'none';
}
</script>

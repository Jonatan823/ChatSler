<script type="module">
    // 1. Importaciones de Firebase desde la Web (CDN)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
    import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";

    // 2. Tu configuración personal de Firebase (Sler-Chat-Lab)
    const firebaseConfig = {
        apiKey: "AIzaSyD5ItA76Xc7mmihQPC2AUCHQFStii4NAUg",
        authDomain: "sler-chat-lab.firebaseapp.com",
        databaseURL: "https://sler-chat-lab-default-rtdb.firebaseio.com",
        projectId: "sler-chat-lab",
        storageBucket: "sler-chat-lab.firebasestorage.app",
        messagingSenderId: "594954603335",
        appId: "1:594954603335:web:d332aa211e8ecce5521a62"
    };

    // 3. Inicializamos Firebase y la Base de Datos
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // 4. Lógica para el botón de INGRESO
    window.entrar = function() {
        const nick = document.getElementById('nick').value;
        if (nick !== "") {
            document.getElementById('login').style.display = 'none'; // Oculta pantalla de ingreso
            console.log("Sesión iniciada por:", nick);
        } else {
            alert("Por favor, ingresa tu nombre.");
        }
    };

    // 5. Lógica para ENVIAR mensajes a Firebase
    window.enviar = function() {
        const autor = document.getElementById('nick').value;
        const textoOriginal = document.getElementById('texto').value;

        if (textoOriginal !== "") {
            // Guardamos el mensaje en la base de datos (Punto B)
            push(ref(db, 'mensajes'), {
                usuario: autor,
                contenido: textoOriginal,
                timestamp: Date.now()
            });
            document.getElementById('texto').value = ""; // Limpiamos el área de texto
        }
    };

    // 6. Lógica para RECIBIR mensajes en tiempo real y mostrarlos en el Chat
    const chatContainer = document.getElementById('chat-container');
    onChildAdded(ref(db, 'mensajes'), (snapshot) => {
        const msg = snapshot.val();
        const burbuja = document.createElement('div');
        burbuja.className = 'msg';
        burbuja.innerHTML = `
            <div class="nick-label">${msg.usuario}</div>
            <div class="sler-text">${msg.contenido}</div>
        `;
        chatContainer.appendChild(burbuja);
        chatContainer.scrollTop = chatContainer.scrollHeight; // Scroll automático al último mensaje
    });
</script>
